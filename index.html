<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
    <!--<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'">-->
    <script src='https://unpkg.com/@turf/turf@3.8.0/turf.min.js'></script>
    <script> window.module = { exports: {} }; </script>
    <script src="https://unpkg.com/@mapbox/tilebelt@1.0.2/index.js"></script>
    <script> window.tilebelt = window.module.exports; </script>
    <script type="importmap">
        {
            "imports": {
                "three": "./node_modules/three/build/three.module.js",
                "@environment-safe/canvas":"./node_modules/@environment-safe/canvas/src/index.mjs",
                "@environment-safe/file":"./node_modules/@environment-safe/file/src/index.mjs",
                "@environment-safe/tween":"./node_modules/@environment-safe/tween/src/index.mjs",
                "@environment-safe/runtime-context":"./node_modules/@environment-safe/runtime-context/src/index.mjs",
                "@yantra-core/sutra":"/node_modules/@yantra-core/sutra/lib/sutra.js",
                "submesh-treadmill": "./node_modules/submesh-treadmill/submesh-treadmill.js",
                "chai": "./node_modules/chai/chai.js",
                "skeleton-keyhole": "./node_modules/skeleton-keyhole/src/index.mjs",
                "skeleton-keyhole/leaflet": "./node_modules/skeleton-keyhole/src/leaflet.mjs",
                "skeleton-keyhole/mapbox": "./node_modules/skeleton-keyhole/src/mapbox.mjs",
                "skeleton-keyhole/miniplot": "./node_modules/skeleton-keyhole/src/miniplot.mjs",
                "@environment-safe/elements":"./node_modules/@environment-safe/elements/src/index.mjs",
                "browser-or-node":"./node_modules/browser-or-node/src/index.js", 
                "chai": "./node_modules/chai/chai.js",
                "sift": "./node_modules/sift/es5m/index.js",
                "stats.js": "./node_modules/stats.js/src/Stats.js",
                "dat.gui": "./node_modules/dat.gui/src/dat/index.js",
                "three-spritetext": "./node_modules/three-spritetext/dist/three-spritetext.mjs",
                "bitwise-logger": "./node_modules/bitwise-logger/bitwise-logger.js",
                "cannon-es": "./node_modules/cannon-es/dist/cannon-es.js",
                "extended-emitter-es6": "./node_modules/extended-emitter/extended-emitter.mjs",
                "three/addons/controls/OrbitControls.js": "./node_modules/three/examples/jsm/controls/OrbitControls.js",
                "three/addons/geometries/TextGeometry.js":"./node_modules/three/examples/jsm/geometries/TextGeometry.js",
                "three/examples/jsm/loaders/FBXLoader":"./node_modules/three/examples/jsm/loaders/FBXLoader.js",
                "module": "./src/safe-emitter.js",
                "fs": "./src/safe-emitter.js",
                "os": "./src/safe-emitter.js",
                "extended-emitter": "/node_modules/extended-emitter/extended-emitter.mjs",
                "node:events": "/node_modules/extended-emitter/node-events.mjs"
            }
        }
    </script>
    <link rel="stylesheet" href="styles.css">
    <title>Aleister E. Crawl</title>
  </head>
  <body>
    <script type="module">
      //import 'skeleton-keyhole/mapbox';
      import 'skeleton-keyhole/leaflet';
      import 'skeleton-keyhole/miniplot';
      import 'skeleton-keyhole';
    </script>
    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token') || 'no-token';
      const map = `<div id="minimap">
        <skeleton-keyhole
            engine="miniplot"
            identifier="mapcontainer"
            id="minimap"
            placeHolder="./node_modules/skeleton-keyhole/test/static/assets/tile-placeholder.png"
            token="${token}"
            zoom="19"
            min-zoom="18"
            max-zoom="19"
            center="[0, 0]"
            bounds="[[-25, -25], [25, 25]]"
            mapStyle='{"version":8,"name":"Empty","sources":{},"layers":[{"id":"background","type":"background","paint":{"background-color":"hsl(47, 26%, 88%)"}}],"id":"empty"}'
        >
            <keyhole-tiles
                url="http://localhost:3000/minimap/basemap/{z}/{x}/{y}/tile.png?level=oo"
            ></keyhole-tiles>
        </skeleton-keyhole>
      </div>`;
      document.write(map);
    </script>
    <div class="game-world"></div>
    <script type="module" src="./client.js"></script>
    <script>
      const m = document.getElementsByTagName('skeleton-keyhole')[0];
      m.addEventListener('load', (e)=>{
        //console.log('??', m.coordsToGeo([1, 1]))
      });
    </script>
  </body>
</html>